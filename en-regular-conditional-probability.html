<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.33">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Liyve">
<meta name="dcterms.date" content="2025-06-23">

<title>Final Assignment of Selected Topics in Probability – Liyve’s Notes</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-ea385d0e468b0dd5ea5bf0780b1290d9.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark-bc185b5c5bdbcb35c2eb49d8a876ef70.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-ea385d0e468b0dd5ea5bf0780b1290d9.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-0ac8d00b4664b05a3a1a3f14a2968a1e.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark-36b843aecd780cd84c0d0bd3a9cdf38b.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="site_libs/bootstrap/bootstrap-0ac8d00b4664b05a3a1a3f14a2968a1e.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: {
    Macros: {
      SunQuarTeX: "\\phantom{}\\kern-.0em\\lower.0ex\\hbox{$\\mathbf S$}\\kern-.045em\\lower.0ex\\hbox{$\\scriptstyle \\mathbf U$}\\kern-.045em\\hbox{$\\scriptstyle \\mathbb N$}\\kern-.0em\\hbox{$\\mathbb Q$}\\kern-.045em\\lower.0ex\\hbox{$\\scriptstyle \\mathbf U$}\\kern-.135em\\lower.0ex\\hbox{$\\scriptstyle \\mathbf A$}\\kern-.09em\\lower.0ex\\hbox{$\\scriptstyle \\mathbb R$}\\kern-.072em\\mathbf{\\TeX}"
    }
  }
});
</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-fixed quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const darkModeDefault = authorPrefersDark;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Liyve’s Notes</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Overview</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-algebra" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Algebra</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-algebra">    
        <li>
    <a class="dropdown-item" href="./en-commutative-algebra.html">
 <span class="dropdown-text">Commutative Algebra</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-number-theory" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Number Theory</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-number-theory">    
        <li>
    <a class="dropdown-item" href="./en-pre-classification-quadratic-forms-over-q.html">
 <span class="dropdown-text">Classification of Quadratic Forms over ℚ</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-probability" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Probability</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-probability">    
        <li>
    <a class="dropdown-item" href="./en-regular-conditional-probability.html">
 <span class="dropdown-text">Regular Conditional Probability (EN)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./cn-regular-conditional-probability.html">
 <span class="dropdown-text">正则条件概率 (中文)</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/Liyvew/Mathematics-Notes-Repository"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul class="collapse">
  <li><a href="#foreword" id="toc-foreword" class="nav-link active" data-scroll-target="#foreword"><span class="header-section-number">1</span> Foreword</a></li>
  <li><a href="#regular-conditional-probability" id="toc-regular-conditional-probability" class="nav-link" data-scroll-target="#regular-conditional-probability"><span class="header-section-number">2</span> Regular Conditional Probability</a></li>
  <li><a href="#the-existence-of-regular-conditional-probability" id="toc-the-existence-of-regular-conditional-probability" class="nav-link" data-scroll-target="#the-existence-of-regular-conditional-probability"><span class="header-section-number">3</span> The Existence of Regular Conditional Probability</a></li>
  <li><a href="#the-uniqueness-of-regular-conditional-probability" id="toc-the-uniqueness-of-regular-conditional-probability" class="nav-link" data-scroll-target="#the-uniqueness-of-regular-conditional-probability"><span class="header-section-number">4</span> The Uniqueness of Regular Conditional Probability</a></li>
  <li><a href="#representation-of-conditional-expectation-as-an-integral" id="toc-representation-of-conditional-expectation-as-an-integral" class="nav-link" data-scroll-target="#representation-of-conditional-expectation-as-an-integral"><span class="header-section-number">5</span> Representation of Conditional Expectation as an Integral</a></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion"><span class="header-section-number">6</span> Conclusion</a></li>
  <li><a href="#acknowledgement" id="toc-acknowledgement" class="nav-link" data-scroll-target="#acknowledgement">Acknowledgement</a></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="en-regular-conditional-probability.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">


<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Final Assignment of Selected Topics in Probability</h1>
<p class="subtitle lead">The Existence and Uniqueness of Regular Conditional Probability</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Liyve </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">June 23, 2025</p>
    </div>
  </div>
  
    <div>
    <div class="quarto-title-meta-heading">Modified</div>
    <div class="quarto-title-meta-contents">
      <p class="date-modified">July 2, 2025</p>
    </div>
  </div>
    
  </div>
  
<div>
  <div class="abstract">
    <div class="block-title">Abstract</div>
    This assignment explores the concept of regular conditional probability, focusing on its existence and uniqueness. However, the proofs for existence and uniqueness were not provided in <span class="citation" data-cites="Rockner2016ProbabilityNotes"><a href="#ref-Rockner2016ProbabilityNotes" role="doc-biblioref">[1]</a></span>. As a result, rigorously establishing these proofs became the central focus of the assignment.
  </div>
</div>


</header>


<section id="foreword" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="foreword"><span class="header-section-number">1</span> Foreword</h2>
<p>During last semester’s study of <em>Probability Theory (bilingual course)</em>, students at the <strong>Qiushi College</strong> were learning <em>Probability Theory</em> using the textbook <span class="citation" data-cites="李贤平1997概率论基础"><a href="#ref-李贤平1997概率论基础" role="doc-biblioref">[2]</a></span> . This textbook does not introduce probability theory through the language of measure theory, nor does it cover the concept of conditional expectation. However, during a proof in <em>Mathematical Statistics</em> in the second week of this semester, conditional expectation appeared in the textbook <span class="citation" data-cites="韦来生2015数理统计"><a href="#ref-韦来生2015数理统计" role="doc-biblioref">[3]</a></span> as an integral of conditional probability. This led me to hypothesize that the concept of conditional expectation mentioned in the textbook <span class="citation" data-cites="韦来生2015数理统计"><a href="#ref-韦来生2015数理统计" role="doc-biblioref">[3]</a></span> must be the same as what we studied last semester <span class="citation" data-cites="Rockner2016ProbabilityNotes"><a href="#ref-Rockner2016ProbabilityNotes" role="doc-biblioref">[1]</a></span>. After discussions with classmates, we failed to reach a satisfactory conclusion. It was not until the fourth week, during the <em>Selected Topics in Probability</em>, that the concept of regular conditional probability was briefly introduced. Unfortunately, <span class="citation" data-cites="Rockner2016ProbabilityNotes"><a href="#ref-Rockner2016ProbabilityNotes" role="doc-biblioref">[1]</a></span> claimed that this topic had little relevance to the subsequent course content and thus avoided further discussion. Consequently, I decided to explore this topic as the focus of my final assignment.</p>
</section>
<section id="regular-conditional-probability" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="regular-conditional-probability"><span class="header-section-number">2</span> Regular Conditional Probability</h2>
<p>In our in-class discussion, we observed that conditional probability <span class="math display">\[
P[A\mid \mathcal{A}_0]:=\mathbb{E}[\mathbb{I}_A\mid\mathcal{A}_0]
\]</span> satisfies <span class="math display">\[
0\leq P[A\mid\mathcal{A}_0]\leq 1
\]</span></p>
<p><span class="math display">\[
P[\emptyset\mid\mathcal{A}_0]=0;\ P[\Omega\mid\mathcal{A}_0]=1
\]</span></p>
<p>for <span class="math inline">\(A_n,\ n\in\mathbb{N}\)</span>, pairwise disjoint <span class="math display">\[
P[\bigcup_{n=1}^{\infty}A_n\mid \mathcal{A}_0]=\sum_{n=1}^{\infty}P[A_n\mid \mathcal{A}_0]
\]</span> almost surely.</p>
<p>However, the null exceptional set depends on all of measurable set <span class="math inline">\(A\)</span>, and there exists no universal null set that makes the conditional probability be a probability measure. This motivates us to explore a more refined approach to characterize <span class="math inline">\(P[A\mid \mathcal{A}_0]\)</span> in a stronger sense.</p>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<div id="def-probability-kernel" class="theorem definition">
<p><span class="theorem-title"><strong>Definition 1 (Probability Kernel)</strong></span> Let <span class="math inline">\((\Omega,\mathcal{A})\)</span> and <span class="math inline">\((\Omega',\mathcal{A}')\)</span> be a pair of measurable spaces. A function <span class="math inline">\(K:\Omega\times\mathcal{A}'\to[0,1]\)</span> satisfy:</p>
<ul>
<li><p><span class="math inline">\(\omega\to K(\omega,A')\)</span> is an <span class="math inline">\(\mathcal{A}\)</span>-measurable map for all <span class="math inline">\(A'\in \mathcal{A}'\)</span>;</p></li>
<li><p><span class="math inline">\(A'\to K(\omega,A')\)</span> is a probability measure on <span class="math inline">\((\Omega',\mathcal{A}')\)</span> for all <span class="math inline">\(\omega\in\Omega\)</span>.</p></li>
</ul>
<p>Then we call it <strong>Probability Kernel</strong>.</p>
</div>
</div>
</div>
</div>
<p>To obtain the desired “conditional probability”, we need to work within a better-behaved space, where such constructions can be rigorously defined.</p>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<div id="def-standard-borel-space" class="theorem definition">
<p><span class="theorem-title"><strong>Definition 2 (Standard Borel Space)</strong></span> A measurable space <span class="math inline">\((\Omega,\mathcal{A})\)</span> is called <strong>standard Borel space</strong>, if there exists a complete metric <span class="math inline">\(d\)</span> on <span class="math inline">\(\Omega\)</span>, such that <span class="math inline">\((\Omega,d)\)</span> is separable and the Borel <span class="math inline">\(\sigma\)</span>-algebra <span class="math inline">\(\mathcal{A}\)</span> is generated by the topology on <span class="math inline">\((\Omega,d)\)</span>.</p>
</div>
</div>
</div>
</div>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<div id="prp-regular-conditional-probability" class="theorem proposition">
<p><span class="theorem-title"><strong>Proposition 1 (Regular Conditional Probability)</strong></span> cf.<span class="citation" data-cites="Rockner2016ProbabilityNotes"><a href="#ref-Rockner2016ProbabilityNotes" role="doc-biblioref">[1, Proposition 5.4.3]</a></span></p>
<p>Let <span class="math inline">\((\Omega,\mathcal{A})\)</span> be a standard Borel space, <span class="math inline">\(P\)</span> a probability measure on <span class="math inline">\((\Omega,\mathcal{A})\)</span>. Then for each <span class="math inline">\(\sigma\)</span>-algebra <span class="math inline">\(\mathcal{A}_0\subseteq\mathcal{A}\)</span>, there exists a probability kernel <span class="math inline">\(K_{\mathcal{A}_0}\)</span> from <span class="math inline">\((\Omega,\mathcal{A}_0)\)</span> to <span class="math inline">\((\Omega,\mathcal{A})\)</span>, such that for all <span class="math inline">\(A\in\mathcal{A}\)</span>, it holds that:</p>
<p><span class="math display">\[
K_{\mathcal{A}_0}(\omega,A)=P[A\mid\mathcal{A}_0](\omega)\text{ for all }P\text{-a.s. }\omega\in\Omega.
\]</span> where the exceptional set might depend on <span class="math inline">\(A\)</span>.</p>
<p>If <span class="math inline">\(\tilde{K}_{\mathcal{A}_0}\)</span> is another probability kernel from <span class="math inline">\((\Omega,\mathcal{A}_0)\)</span> to <span class="math inline">\((\Omega,\mathcal{A})\)</span> with the same property, then there exists a <span class="math inline">\(P\)</span>-zero set <span class="math inline">\(N\in\mathcal{A}\)</span>, such that for every <span class="math inline">\(\omega\in\Omega\setminus N\)</span> and every <span class="math inline">\(A\in\mathcal{A}\)</span>, it holds that:</p>
<p><span class="math display">\[
K_{\mathcal{A}_0}(\omega,A)=\tilde{K}_{\mathcal{A}_0}(\omega,A)\text{ for all }A\in\mathcal{A}.
\]</span></p>
<p>The probability <span class="math inline">\(K_{\mathcal{A}_0}(\omega,A)\)</span> is called regular conditional probability given by <span class="math inline">\(\mathcal{A}_0\)</span>.</p>
</div>
</div>
</div>
</div>
</section>
<section id="the-existence-of-regular-conditional-probability" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="the-existence-of-regular-conditional-probability"><span class="header-section-number">3</span> The Existence of Regular Conditional Probability</h2>
<p>Before proceeding with the proof, we first state and prove some lemmas and theorems that will be essential for the following arguments.</p>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<div id="lem-doob-dynkin" class="theorem lemma">
<p><span class="theorem-title"><strong>Lemma 1 (Doob-Dynkin lemma)</strong></span> Let <span class="math inline">\((\Omega, \mathcal{A}, P)\)</span> be a probability space, and let <span class="math inline">\(X: \Omega \to S\)</span> be a measurable function into a measurable space <span class="math inline">\((S, \mathcal{S})\)</span>. If <span class="math inline">\(f: \Omega \to \mathbb{R}\)</span> is <span class="math inline">\(\sigma(X)\)</span>-measurable, then there exists a measurable function <span class="math inline">\(g: S \to \mathbb{R}\)</span> such that <span class="math inline">\(f = g \circ X\)</span> almost surely.</p>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Proof (Proof of <a href="#lem-doob-dynkin" class="quarto-xref">Lemma&nbsp;1</a>)
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="proof">
<p><span class="proof-title"><em>Proof</em> (Proof of <a href="#lem-doob-dynkin" class="quarto-xref">Lemma&nbsp;1</a>). </span>Let <span class="math inline">\(f: \Omega \to \mathbb{R}\)</span> be <span class="math inline">\(\sigma(X)\)</span>-measurable, where <span class="math inline">\(X: \Omega \to S\)</span> is measurable.</p>
<section id="step-1-structure-of-sigmax" class="level4">
<h4 class="anchored" data-anchor-id="step-1-structure-of-sigmax">Step 1: Structure of <span class="math inline">\(\sigma(X)\)</span></h4>
<p>The <span class="math inline">\(\sigma\)</span>-algebra <span class="math inline">\(\sigma(X)\)</span> generated by <span class="math inline">\(X\)</span> is defined as: <span class="math display">\[
\sigma(X) = \{ X^{-1}(B) : B \in \mathcal{S} \}.
\]</span> Since <span class="math inline">\(f\)</span> is <span class="math inline">\(\sigma(X)\)</span>-measurable, for every Borel set <span class="math inline">\(B \subseteq \mathbb{R}\)</span>, we have: <span class="math display">\[
f^{-1}(B) \in \sigma(X).
\]</span> Thus, there exists a set <span class="math inline">\(A_B \in \mathcal{S}\)</span> such that: <span class="math display">\[
f^{-1}(B) = X^{-1}(A_B).
\]</span> This defines a mapping <span class="math inline">\(B \mapsto A_B\)</span> from Borel sets in <span class="math inline">\(\mathbb{R}\)</span> to <span class="math inline">\(\mathcal{S}\)</span>. To ensure consistency, this mapping must preserve set operations (e.g., unions, intersections, complements), which follows from the fact that <span class="math inline">\(f^{-1}\)</span> and <span class="math inline">\(X^{-1}\)</span> are both <span class="math inline">\(\sigma\)</span>-homomorphisms.</p>
</section>
<section id="step-2-constructing-g-via-rational-intervals" class="level4">
<h4 class="anchored" data-anchor-id="step-2-constructing-g-via-rational-intervals">Step 2: Constructing <span class="math inline">\(g\)</span> via rational intervals</h4>
<p>We construct <span class="math inline">\(g: S \to \mathbb{R}\)</span> as follows. For each rational <span class="math inline">\(r \in \mathbb{Q}\)</span>, define: <span class="math display">\[
A_r = A_{(-\infty, r]} \in \mathcal{S},
\]</span> where <span class="math inline">\(A_{(-\infty, r]}\)</span> corresponds to the set in <span class="math inline">\(\mathcal{S}\)</span> such that <span class="math inline">\(f^{-1}((-\infty, r]) = X^{-1}(A_r)\)</span>.</p>
<p>For <span class="math inline">\(s \in S\)</span>, define: <span class="math display">\[
g(s) = \inf \{ r \in \mathbb{Q} : s \in A_r \}.
\]</span> This infimum is well-defined because:</p>
<ul>
<li><p>For any <span class="math inline">\(s \in S\)</span>, since <span class="math inline">\(f(\omega) \in \mathbb{R}\)</span> for all <span class="math inline">\(\omega\)</span>, there exists some <span class="math inline">\(r \in \mathbb{Q}\)</span> such that <span class="math inline">\(f(\omega) \leq r\)</span>, hence <span class="math inline">\(X(\omega) \in A_r\)</span>.</p></li>
<li><p>The set <span class="math inline">\(\{ r \in \mathbb{Q} : s \in A_r \}\)</span> is bounded below (by, say, <span class="math inline">\(-\infty\)</span>).</p></li>
</ul>
</section>
<section id="step-3-verifying-f-g-circ-x-almost-surely" class="level4">
<h4 class="anchored" data-anchor-id="step-3-verifying-f-g-circ-x-almost-surely">Step 3: Verifying <span class="math inline">\(f = g \circ X\)</span> almost surely</h4>
<p>Let <span class="math inline">\(\omega \in \Omega\)</span>. We claim that <span class="math inline">\(f(\omega) = g(X(\omega))\)</span> except on a <span class="math inline">\(P\)</span>-null set.</p>
<ul>
<li><p><strong>For <span class="math inline">\(f(\omega) \leq r\)</span> with <span class="math inline">\(r \in \mathbb{Q}\)</span>:</strong></p>
<ul>
<li><p>If <span class="math inline">\(f(\omega) \leq r\)</span>, then <span class="math inline">\(\omega \in f^{-1}((-\infty, r]) = X^{-1}(A_r)\)</span>, so <span class="math inline">\(X(\omega) \in A_r\)</span>, implying <span class="math inline">\(g(X(\omega)) \leq r\)</span>.</p></li>
<li><p>Conversely, if <span class="math inline">\(X(\omega) \in A_r\)</span>, then <span class="math inline">\(g(X(\omega)) \leq r\)</span>, so <span class="math inline">\(f(\omega) \leq r\)</span>.</p></li>
</ul></li>
<li><p><strong>For <span class="math inline">\(f(\omega) \geq r\)</span> with <span class="math inline">\(r \in \mathbb{Q}\)</span>:</strong></p>
<ul>
<li>If <span class="math inline">\(f(\omega) &gt; r\)</span>, then <span class="math inline">\(\omega \notin f^{-1}((-\infty, r]) = X^{-1}(A_r)\)</span>, so <span class="math inline">\(X(\omega) \notin A_r\)</span>, implying <span class="math inline">\(g(X(\omega)) &gt; r\)</span>.</li>
</ul></li>
</ul>
<p>Thus, <span class="math inline">\(g(X(\omega)) \leq f(\omega)\)</span> and <span class="math inline">\(g(X(\omega)) \geq f(\omega)\)</span> hold for all <span class="math inline">\(\omega\)</span> outside a null set where <span class="math inline">\(f(\omega)\)</span> may not equal <span class="math inline">\(g(X(\omega))\)</span>. However, since <span class="math inline">\(f\)</span> and <span class="math inline">\(g \circ X\)</span> are measurable, the set <span class="math inline">\(\{ \omega : f(\omega) \neq g(X(\omega)) \}\)</span> is measurable and has measure zero.</p>
</section>
<section id="step-4-measurability-of-g" class="level4">
<h4 class="anchored" data-anchor-id="step-4-measurability-of-g">Step 4: Measurability of <span class="math inline">\(g\)</span></h4>
<p>To show <span class="math inline">\(g\)</span> is <span class="math inline">\(\mathcal{S}\)</span>-measurable, we verify that for any <span class="math inline">\(a \in \mathbb{R}\)</span>, the set <span class="math inline">\(\{ s \in S : g(s) \leq a \}\)</span> belongs to <span class="math inline">\(\mathcal{S}\)</span>.</p>
<ul>
<li><p><strong>For rational <span class="math inline">\(a\)</span>:</strong> <span class="math display">\[
\{ s \in S : g(s) \leq a \} = \bigcap_{\substack{r \in \mathbb{Q} \\ r &lt; a}} A_r^c \cup A_a.
\]</span> This follows from the definition of <span class="math inline">\(g\)</span> as an infimum over rationals.</p></li>
<li><p><strong>For general <span class="math inline">\(a \in \mathbb{R}\)</span>:</strong> Approximate <span class="math inline">\(a\)</span> by a decreasing sequence of rationals <span class="math inline">\(\{r_n\}\)</span>. Then: <span class="math display">\[
\{ s \in S : g(s) \leq a \} = \bigcap_{n=1}^\infty A_{r_n}.
\]</span> Since each <span class="math inline">\(A_{r_n} \in \mathcal{S}\)</span>, the countable intersection is also in <span class="math inline">\(\mathcal{S}\)</span>.</p></li>
</ul>
<p>Hence, <span class="math inline">\(g\)</span> is <span class="math inline">\(\mathcal{S}\)</span>-measurable.</p>
</section>
<section id="step-5-uniqueness-up-to-null-sets" class="level4">
<h4 class="anchored" data-anchor-id="step-5-uniqueness-up-to-null-sets">Step 5: Uniqueness up to null sets</h4>
<p>If <span class="math inline">\(g'\)</span> is another measurable function satisfying <span class="math inline">\(f = g' \circ X\)</span> almost surely, then <span class="math inline">\(g(X(\omega)) = g'(X(\omega))\)</span> for <span class="math inline">\(P\)</span>-almost every <span class="math inline">\(\omega\)</span>. Since <span class="math inline">\(X\)</span> is measurable, the pushforward measure <span class="math inline">\(P_X = P \circ X^{-1}\)</span> ensures that <span class="math inline">\(g = g'\)</span> almost surely with respect to <span class="math inline">\(P_X\)</span>.</p>
<p>We have constructed a measurable function <span class="math inline">\(g: S \to \mathbb{R}\)</span> such that <span class="math inline">\(f = g \circ X\)</span> almost surely, completing the proof.</p>
</section>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Remark
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<div class="proof remark">
<p><span class="proof-title"><em>Remark</em>. </span>The <strong>Doob-Dynkin lemma</strong> establishes that any <span class="math inline">\(\sigma(X)\)</span>-measurable function <span class="math inline">\(f\)</span> can be expressed as <span class="math inline">\(f = g \circ X\)</span> for some measurable <span class="math inline">\(g\)</span>. In the context of regular conditional probabilities, it ensures that the conditional expectation <span class="math inline">\(\mathbb{E}[1_A \mid \mathcal{A}_0]\)</span>, being <span class="math inline">\(\mathcal{A}_0\)</span>-measurable, can be represented as a function of a generating random variable <span class="math inline">\(\eta\)</span> (e.g., <span class="math inline">\(\eta(\omega) = \omega\)</span>). This allows the construction of the kernel <span class="math inline">\(K_{\mathcal{A}_0}(\omega, A)\)</span> as a measurable function of <span class="math inline">\(\omega\)</span>, satisfying the required properties.</p>
</div>
</div>
</div>
</div>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<div id="thm-Caratheodory-extension-theorem" class="theorem">
<p><span class="theorem-title"><strong>Theorem 1 (Carathéodory extension theorem)</strong></span> Let <span class="math inline">\(\mathcal{C}\)</span> be an algebra of subsets of a set <span class="math inline">\(\Omega\)</span>, and let <span class="math inline">\(\mu_0: \mathcal{C} \to [0, \infty]\)</span> be a countably additive pre-measure. Then there exists a measure <span class="math inline">\(\mu\)</span> on the <span class="math inline">\(\sigma\)</span>-algebra <span class="math inline">\(\mathcal{A} = \sigma(\mathcal{C})\)</span> such that <span class="math inline">\(\mu|_{\mathcal{C}} = \mu_0\)</span>. Moreover, this extension is unique if <span class="math inline">\(\mu_0\)</span> is <span class="math inline">\(\sigma\)</span>-finite.</p>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Proof (Proof of <a href="#thm-Caratheodory-extension-theorem" class="quarto-xref">Theorem&nbsp;1</a>)
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="proof">
<p><span class="proof-title"><em>Proof</em> (Proof of <a href="#thm-Caratheodory-extension-theorem" class="quarto-xref">Theorem&nbsp;1</a>). </span>Let <span class="math inline">\(\mathcal{C}\)</span> be an algebra of subsets of <span class="math inline">\(\Omega\)</span>, and <span class="math inline">\(\mu_0: \mathcal{C} \to [0, \infty]\)</span> a countably additive pre-measure.</p>
<section id="step-1-outer-measure-construction" class="level4">
<h4 class="anchored" data-anchor-id="step-1-outer-measure-construction">Step 1: Outer measure construction</h4>
<p>Define the outer measure <span class="math inline">\(\mu^*\)</span> on all subsets <span class="math inline">\(E \subseteq \Omega\)</span> by <span class="math display">\[
\mu^*(E) = \inf\left\{ \sum_{n=1}^\infty \mu_0(C_n) : E \subseteq \bigcup_{n=1}^\infty C_n,\, C_n \in \mathcal{C} \right\}.
\]</span> We verify that <span class="math inline">\(\mu^*\)</span> is an outer measure:</p>
<ul>
<li><p><strong>Monotonicity</strong>: If <span class="math inline">\(A \subseteq B\)</span>, then any cover of <span class="math inline">\(B\)</span> is also a cover of <span class="math inline">\(A\)</span>, so <span class="math inline">\(\mu^*(A) \leq \mu^*(B)\)</span>.</p></li>
<li><p><strong>Countable subadditivity</strong>: For any sequence <span class="math inline">\(\{A_n\}\)</span>, we construct covers <span class="math inline">\(\{C_{n,k}\}_{k=1}^\infty\)</span> of <span class="math inline">\(A_n\)</span> with <span class="math inline">\(\sum_{k=1}^\infty \mu_0(C_{n,k}) \leq \mu^*(A_n) + \epsilon/2^n\)</span>. The union <span class="math inline">\(\bigcup_{n,k} C_{n,k}\)</span> covers <span class="math inline">\(\bigcup_n A_n\)</span>, and <span class="math inline">\(\sum_{n,k} \mu_0(C_{n,k}) \leq \sum_n \mu^*(A_n) + \epsilon\)</span>. Letting <span class="math inline">\(\epsilon \to 0\)</span> gives <span class="math inline">\(\mu^*(\bigcup_n A_n) \leq \sum_n \mu^*(A_n)\)</span>.</p></li>
<li><p><strong>Empty set</strong>: <span class="math inline">\(\mu^*(\emptyset) = 0\)</span> since <span class="math inline">\(\emptyset \subseteq \emptyset\)</span> and <span class="math inline">\(\mu_0(\emptyset) = 0\)</span>.</p></li>
</ul>
</section>
<section id="step-2-carathéodory-measurability" class="level4">
<h4 class="anchored" data-anchor-id="step-2-carathéodory-measurability">Step 2: Carathéodory measurability</h4>
<p>A set <span class="math inline">\(A \subseteq \Omega\)</span> is called <span class="math inline">\(\mu^*\)</span>-measurable if for all <span class="math inline">\(E \subseteq \Omega\)</span>, <span class="math display">\[
\mu^*(E) = \mu^*(E \cap A) + \mu^*(E \setminus A).
\]</span> Let <span class="math inline">\(\mathcal{A}\)</span> be the collection of all <span class="math inline">\(\mu^*\)</span>-measurable sets. We show <span class="math inline">\(\mathcal{A}\)</span> is a <span class="math inline">\(\sigma\)</span>-algebra:</p>
<ul>
<li><p><strong>Closed under complements</strong>: If <span class="math inline">\(A \in \mathcal{A}\)</span>, then <span class="math inline">\(A^c\)</span> satisfies the same condition by symmetry.</p></li>
<li><p><strong>Closed under countable unions</strong>: First, prove closure under finite unions by induction. For countable unions <span class="math inline">\(\bigcup_{n=1}^\infty A_n\)</span>, use induction to show finite unions <span class="math inline">\(\bigcup_{n=1}^N A_n \in \mathcal{A}\)</span>, then apply the definition of <span class="math inline">\(\mu^*\)</span>-measurability to approximate <span class="math inline">\(\bigcup_{n=1}^\infty A_n\)</span> by finite unions and take <span class="math inline">\(N \to \infty\)</span>.</p></li>
</ul>
</section>
<section id="step-3-restriction-to-mathcala-is-a-measure" class="level4">
<h4 class="anchored" data-anchor-id="step-3-restriction-to-mathcala-is-a-measure">Step 3: Restriction to <span class="math inline">\(\mathcal{A}\)</span> is a measure</h4>
<p>The restriction <span class="math inline">\(\mu = \mu^*|_{\mathcal{A}}\)</span> is a measure. To verify countable additivity:</p>
<ul>
<li><p>Let <span class="math inline">\(\{A_n\} \subseteq \mathcal{A}\)</span> be pairwise disjoint. By countable subadditivity, <span class="math inline">\(\mu^*(\bigcup_n A_n) \leq \sum_n \mu^*(A_n)\)</span>.</p></li>
<li><p>For the reverse inequality, fix <span class="math inline">\(N \in \mathbb{N}\)</span> and apply the Carathéodory condition iteratively to <span class="math inline">\(E = \bigcup_{n=1}^N A_n\)</span> and <span class="math inline">\(A_{N+1}\)</span>, showing <span class="math inline">\(\mu^*(\bigcup_{n=1}^{N+1} A_n) = \sum_{n=1}^{N+1} \mu^*(A_n)\)</span>. Taking <span class="math inline">\(N \to \infty\)</span> and using monotonicity gives <span class="math inline">\(\mu^*(\bigcup_n A_n) \geq \sum_n \mu^*(A_n)\)</span>.</p></li>
</ul>
</section>
<section id="step-4-extension-property" class="level4">
<h4 class="anchored" data-anchor-id="step-4-extension-property">Step 4: Extension property</h4>
<p>For <span class="math inline">\(C \in \mathcal{C}\)</span>, we prove <span class="math inline">\(C\)</span> is <span class="math inline">\(\mu^*\)</span>-measurable and <span class="math inline">\(\mu^*(C) = \mu_0(C)\)</span>:</p>
<ul>
<li><p><strong>Measurability</strong>: For any <span class="math inline">\(E \subseteq \Omega\)</span>, let <span class="math inline">\(\{C_n\}\)</span> be a cover of <span class="math inline">\(E\)</span>. Then <span class="math inline">\(C_n \cap C\)</span> and <span class="math inline">\(C_n \setminus C\)</span> belong to <span class="math inline">\(\mathcal{C}\)</span> (since <span class="math inline">\(\mathcal{C}\)</span> is an algebra), and <span class="math inline">\(\mu_0(C_n) = \mu_0(C_n \cap C) + \mu_0(C_n \setminus C)\)</span>. Summing over <span class="math inline">\(n\)</span> gives <span class="math inline">\(\sum_n \mu_0(C_n) \geq \mu^*(E \cap C) + \mu^*(E \setminus C)\)</span>. Taking infima over covers yields <span class="math inline">\(\mu^*(E) \geq \mu^*(E \cap C) + \mu^*(E \setminus C)\)</span>.</p></li>
<li><p><strong>Equality</strong>: By definition, <span class="math inline">\(\mu^*(C) \leq \mu_0(C)\)</span>. For the reverse inequality, suppose <span class="math inline">\(C \subseteq \bigcup_n C_n\)</span>. Then <span class="math inline">\(\mu_0(C) \leq \sum_n \mu_0(C_n \cap C)\)</span> (by countable subadditivity of <span class="math inline">\(\mu_0\)</span>) <span class="math inline">\(\leq \sum_n \mu_0(C_n)\)</span>. Taking infima gives <span class="math inline">\(\mu^*(C) \geq \mu_0(C)\)</span>.</p></li>
</ul>
</section>
<section id="step-5-uniqueness" class="level4">
<h4 class="anchored" data-anchor-id="step-5-uniqueness">Step 5: Uniqueness</h4>
<p>If <span class="math inline">\(\mu_0\)</span> is <span class="math inline">\(\sigma\)</span>-finite, the extension is unique. Let <span class="math inline">\(\nu\)</span> be another measure on <span class="math inline">\(\mathcal{A}\)</span> with <span class="math inline">\(\nu|_{\mathcal{C}} = \mu_0\)</span>:</p>
<ul>
<li><p>Apply the <strong><span class="math inline">\(\pi\)</span>-<span class="math inline">\(\lambda\)</span> theorem</strong>:</p>
<p><span class="math inline">\(\mathcal{C}\)</span> is a <span class="math inline">\(\pi\)</span>-system (closed under finite intersections).</p>
<ul>
<li><p>The set <span class="math inline">\(\{A \in \mathcal{A} : \mu(A) = \nu(A)\}\)</span> is a <span class="math inline">\(\lambda\)</span>-system.</p></li>
<li><p>Since <span class="math inline">\(\mu\)</span> and <span class="math inline">\(\nu\)</span> agree on <span class="math inline">\(\mathcal{C}\)</span>, they agree on <span class="math inline">\(\sigma(\mathcal{C})\)</span>.</p></li>
</ul></li>
<li><p><strong><span class="math inline">\(\sigma\)</span>-finiteness</strong>: Write <span class="math inline">\(\Omega = \bigcup_n \Omega_n\)</span> with <span class="math inline">\(\mu_0(\Omega_n) &lt; \infty\)</span>. For each <span class="math inline">\(A \in \mathcal{A}\)</span>, <span class="math inline">\(\mu(A \cap \Omega_n) = \nu(A \cap \Omega_n)\)</span>, so <span class="math inline">\(\mu(A) = \lim_{n \to \infty} \mu(A \cap \Omega_n) = \nu(A)\)</span>.</p></li>
</ul>
</section>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Remark
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<div class="proof remark">
<p><span class="proof-title"><em>Remark</em>. </span>The <strong>Carathéodory extension theorem</strong> ensures that a pre-measure defined on an algebra can be uniquely extended to a measure on the generated <span class="math inline">\(\sigma\)</span>-algebra, provided the pre-measure is <span class="math inline">\(\sigma\)</span>-finite. In the proof of the existence of regular conditional probabilities, it guarantees that the finitely additive map <span class="math inline">\(f_A(\omega) = \mathbb{E}[1_A \mid \mathcal{A}_0](\omega)\)</span>, defined on a countable generator <span class="math inline">\(\mathcal{C}\)</span>, extends uniquely to a probability measure <span class="math inline">\(K_{\mathcal{A}_0}(\omega, \cdot)\)</span> on <span class="math inline">\(\mathcal{A}\)</span>. This step is critical for constructing the regular conditional probability kernel rigorously.</p>
</div>
</div>
</div>
</div>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<div id="thm-k" class="theorem">
<p><span class="theorem-title"><strong>Theorem 2</strong></span> <span class="citation" data-cites="kallenberg2002foundations"><a href="#ref-kallenberg2002foundations" role="doc-biblioref">[4, Theorem 6.3]</a></span></p>
<p>For any Borel space <span class="math inline">\(S\)</span> and measurable space <span class="math inline">\(T\)</span>, let <span class="math inline">\(\xi\)</span> and <span class="math inline">\(\eta\)</span> be random elements in <span class="math inline">\(S\)</span> and <span class="math inline">\(T\)</span>, respectively. Then there exists a probability kernel <span class="math inline">\(\mu\)</span> from <span class="math inline">\(T\)</span> to <span class="math inline">\(S\)</span> satisfying <span class="math display">\[
\mathbb{P}[\xi \in \cdot \mid \eta] = \mu(\eta, \cdot) \text{ a.e. } \mathcal{L}(\eta),
\]</span> and <span class="math inline">\(\mu\)</span> is unique a.e. <span class="math inline">\(\mathcal{L}(\eta)\)</span>.</p>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-5-contents" aria-controls="callout-5" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Proof (Proof of <a href="#thm-k" class="quarto-xref">Theorem&nbsp;2</a>)
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-5" class="callout-5-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="proof">
<p><span class="proof-title"><em>Proof</em> (Proof of <a href="#thm-k" class="quarto-xref">Theorem&nbsp;2</a>). </span>We may assume that <span class="math inline">\(S \in \mathcal{B}(\mathbb{R})\)</span>. For every <span class="math inline">\(r \in \mathbb{Q}\)</span> we may choose some measurable function <span class="math inline">\(f_r = f(\cdot, r): T \to [0, 1]\)</span> such that <span id="eq-1"><span class="math display">\[
f(\eta, r) = \mathbb{P}[\xi \leq r \mid \eta] \quad \text{a.e.}, \quad r \in \mathbb{Q}.
\tag{1}\]</span></span></p>
<p>Let <span class="math inline">\(A\)</span> be the set of all <span class="math inline">\(t\in T\)</span> such that <span class="math inline">\(f(t, r)\)</span> is nondecreasing in <span class="math inline">\(r \in \mathbb{Q}\)</span> with limits 1 and 0 at <span class="math inline">\(\pm\infty\)</span>. Since <span class="math inline">\(A\)</span> is specified by countably many measurable conditions, each of which holds a.e. at <span class="math inline">\(\eta\)</span>, we have <span class="math inline">\(A \in \mathcal{T}\)</span> and <span class="math inline">\(\eta \in A\)</span> a.e. Now define <span class="math display">\[
F(t, x) = \mathbf{1}_A(t) \inf_{r &gt; x} f(t, r) + \mathbf{1}_{A^c}(t) \mathbf{1}\{x \geq 0\}, \quad x \in \mathbb{R},\ t \in T,
\]</span> and note that <span class="math inline">\(F(t, \cdot)\)</span> is a distribution function on <span class="math inline">\(\mathbb{R}\)</span> for every <span class="math inline">\(t \in T\)</span>. Hence, by Proposition~<span class="math inline">\(\ref{prop:2.14}\)</span> there exist some probability measures <span class="math inline">\(m(t, \cdot)\)</span> on <span class="math inline">\(\mathbb{R}\)</span> with <span class="math display">\[
m(t, (-\infty, x]) = F(t, x), \quad x \in \mathbb{R},\ t \in T.
\]</span> The function <span class="math inline">\(F(t, x)\)</span> is clearly measurable in <span class="math inline">\(t\)</span> for each <span class="math inline">\(x\)</span>, and by a monotone class argument it follows that <span class="math inline">\(m\)</span> is a kernel from <span class="math inline">\(T\)</span> to <span class="math inline">\(\mathbb{R}\)</span>.</p>
<p>By <a href="#eq-1" class="quarto-xref">Equation&nbsp;1</a> and the monotone convergence property of <span class="math inline">\(\mathbb{E}^\eta\)</span>, we have <span class="math display">\[
m(\eta, (-\infty, x]) = F(\eta, x) = \mathbb{P}[\xi \leq x \mid \eta] \quad \text{a.e.}, \quad x \in \mathbb{R}.
\]</span> Using a monotone class argument based on the a.e. monotone convergence property, we may extend the last relation to <span id="eq-2"><span class="math display">\[
m(\eta, B) = \mathbb{P}[\xi \in B \mid \eta] \quad \text{a.e.}, \quad B \in \mathcal{B}(\mathbb{R}).
\tag{2}\]</span></span></p>
<p>In particular, we get <span class="math inline">\(m(\eta, S^c) = 0\)</span> a.e., and so <a href="#eq-2" class="quarto-xref">Equation&nbsp;2</a> remains true on <span class="math inline">\(\mathcal{S} = \mathcal{B} \cap S\)</span> with <span class="math inline">\(m\)</span> replaced by the kernel <span class="math display">\[
\mu(t, \cdot) = m(t, \cdot) \mathbf{1}\{m(t, S) = 1\} + \delta_s \mathbf{1}\{m(t, S) &lt; 1\}, \quad t \in T,
\]</span> where <span class="math inline">\(s \in S\)</span> is arbitrary. If <span class="math inline">\(\mu'\)</span> is another kernel with the stated property, then <span class="math display">\[
\mu(\eta, (-\infty, r]) = \mathbb{P}[\xi \leq r \mid \eta] = \mu'(\eta, (-\infty, r]) \quad \text{a.e.}, \quad r \in \mathbb{Q},
\]</span> and a monotone class argument yields <span class="math inline">\(\mu(\eta, \cdot) = \mu'(\eta, \cdot)\)</span> a.e.</p>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-6-contents" aria-controls="callout-6" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Proof (Proof of Existence of Regular Conditional Probability)
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-6" class="callout-6-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="proof">
<p><span class="proof-title"><em>Proof</em> (Proof of Existence of Regular Conditional Probability). </span>Let <span class="math inline">\((\Omega, \mathcal{A})\)</span> be a standard Borel space and <span class="math inline">\(P\)</span> a probability measure on <span class="math inline">\((\Omega, \mathcal{A})\)</span>. Let <span class="math inline">\(\mathcal{A}_0 \subseteq \mathcal{A}\)</span> be a sub-<span class="math inline">\(\sigma\)</span>-algebra.</p>
<section id="step-1-countable-generator-and-conditional-expectation" class="level4">
<h4 class="anchored" data-anchor-id="step-1-countable-generator-and-conditional-expectation">Step 1: Countable Generator and Conditional Expectation</h4>
<p>Since <span class="math inline">\((\Omega, \mathcal{A})\)</span> is standard Borel, there exists a Polish topology on <span class="math inline">\(\Omega\)</span> such that <span class="math inline">\(\mathcal{A}\)</span> is the Borel <span class="math inline">\(\sigma\)</span>-algebra. Standard Borel spaces have the property that every probability measure admits a regular conditional probability with respect to any sub-<span class="math inline">\(\sigma\)</span>-algebra.</p>
<p>Let <span class="math inline">\(\mathcal{C}\)</span> be a countable <span class="math inline">\(\pi\)</span>-system generating <span class="math inline">\(\mathcal{A}\)</span>. For each <span class="math inline">\(A \in \mathcal{C}\)</span>, the conditional expectation <span class="math inline">\(\mathbb{E}[1_A \mid \mathcal{A}_0]\)</span> exists as an <span class="math inline">\(\mathcal{A}_0\)</span>-measurable function, unique up to <span class="math inline">\(P\)</span>-null sets (by the definition of conditional expectation). By the Doob-Dynkin lemma (see <a href="#lem-doob-dynkin" class="quarto-xref">Lemma&nbsp;1</a>), for each <span class="math inline">\(A \in \mathcal{C}\)</span>, there exists a measurable function <span class="math inline">\(f_A: \Omega \to [0,1]\)</span> such that: <span class="math display">\[
\mathbb{E}[1_A \mid \mathcal{A}_0] = f_A \circ \eta \quad \text{a.e. } P,
\]</span> where <span class="math inline">\(\eta\)</span> is a measurable function generating <span class="math inline">\(\mathcal{A}_0\)</span> (e.g., <span class="math inline">\(\eta(\omega) = \omega\)</span>).</p>
</section>
<section id="step-2-construction-of-the-kernel-via-extension" class="level4">
<h4 class="anchored" data-anchor-id="step-2-construction-of-the-kernel-via-extension">Step 2: Construction of the Kernel via Extension</h4>
<p>For fixed <span class="math inline">\(\omega \in \Omega\)</span>, define <span class="math inline">\(f_A(\omega)\)</span> for <span class="math inline">\(A \in \mathcal{C}\)</span>. The map <span class="math inline">\(A \mapsto f_A(\omega)\)</span> is:</p>
<ul>
<li><p><strong>Finitely additive</strong>: For disjoint <span class="math inline">\(A_1, A_2 \in \mathcal{C}\)</span>, <span class="math inline">\(f_{A_1 \cup A_2}(\omega) = f_{A_1}(\omega) + f_{A_2}(\omega)\)</span>.</p></li>
<li><p><strong>Non-negative</strong>: <span class="math inline">\(f_A(\omega) \geq 0\)</span>.</p></li>
<li><p><strong>Normalized</strong>: <span class="math inline">\(f_\Omega(\omega) = 1\)</span>.</p></li>
</ul>
<p>To extend <span class="math inline">\(f_A(\omega)\)</span> to a probability measure on <span class="math inline">\((\Omega, \mathcal{A})\)</span>, we apply the Carathéodory extension theorem (see <a href="#thm-Caratheodory-extension-theorem" class="quarto-xref">Theorem&nbsp;1</a>). However, since <span class="math inline">\(\mathcal{C}\)</span> is a <span class="math inline">\(\pi\)</span>-system, the extension is unique if <span class="math inline">\(f_A(\omega)\)</span> is countably additive on <span class="math inline">\(\mathcal{C}\)</span>. This follows from the dominated convergence theorem and the fact that <span class="math inline">\(\mathcal{C}\)</span> generates <span class="math inline">\(\mathcal{A}\)</span>.</p>
<p>Thus, for <span class="math inline">\(P\)</span>-almost every <span class="math inline">\(\omega\)</span>, there exists a unique probability measure <span class="math inline">\(K_{\mathcal{A}_0}(\omega, \cdot)\)</span> on <span class="math inline">\((\Omega, \mathcal{A})\)</span> such that: <span class="math display">\[
K_{\mathcal{A}_0}(\omega, A) = f_A(\omega) \quad \text{for all } A \in \mathcal{C}.
\]</span></p>
</section>
<section id="step-3-measurability-of-the-kernel" class="level4">
<h4 class="anchored" data-anchor-id="step-3-measurability-of-the-kernel">Step 3: Measurability of the Kernel</h4>
<p>For each <span class="math inline">\(A \in \mathcal{A}\)</span>, the map <span class="math inline">\(\omega \mapsto K_{\mathcal{A}_0}(\omega, A)\)</span> must be <span class="math inline">\(\mathcal{A}_0\)</span>-measurable. Since <span class="math inline">\(\mathcal{C}\)</span> generates <span class="math inline">\(\mathcal{A}\)</span>, we use the <span class="math inline">\(\pi\)</span>-<span class="math inline">\(\lambda\)</span> theorem: - Let <span class="math inline">\(\mathcal{L} = \{ A \in \mathcal{A} : K_{\mathcal{A}_0}(\cdot, A) \text{ is } \mathcal{A}_0\text{-measurable} \}\)</span>. - <span class="math inline">\(\mathcal{L}\)</span> is a <span class="math inline">\(\lambda\)</span>-system containing the <span class="math inline">\(\pi\)</span>-system <span class="math inline">\(\mathcal{C}\)</span>, hence <span class="math inline">\(\mathcal{L} = \mathcal{A}\)</span>.</p>
</section>
<section id="step-4-joint-measurability" class="level4">
<h4 class="anchored" data-anchor-id="step-4-joint-measurability">Step 4: Joint Measurability</h4>
<p>By <a href="#thm-k" class="quarto-xref">Theorem&nbsp;2</a>, there exists a probability kernel <span class="math inline">\(\mu\)</span> from <span class="math inline">\(\mathcal{A}_0\)</span> to <span class="math inline">\(\mathcal{A}\)</span> such that: <span class="math display">\[
\mathbb{P}[\xi \in \cdot \mid \eta] = \mu(\eta, \cdot) \quad \text{a.e. } \mathcal{L}(\eta),
\]</span> where <span class="math inline">\(\xi\)</span> and <span class="math inline">\(\eta\)</span> are random elements in <span class="math inline">\(\Omega\)</span>. Here, <span class="math inline">\(\mu(\eta(\omega), A) = K_{\mathcal{A}_0}(\omega, A)\)</span> for <span class="math inline">\(P\)</span>-almost every <span class="math inline">\(\omega\)</span>. The joint measurability of <span class="math inline">\((\omega, A) \mapsto K_{\mathcal{A}_0}(\omega, A)\)</span> follows from the construction using a countable generator <span class="math inline">\(\mathcal{C}\)</span> and the uniqueness of <span class="math inline">\(\mu\)</span> a.e. <span class="math inline">\(\mathcal{L}(\eta)\)</span>.</p>
</section>
<section id="step-5-verification-of-conditional-probability" class="level4">
<h4 class="anchored" data-anchor-id="step-5-verification-of-conditional-probability">Step 5: Verification of Conditional Probability</h4>
<p>For all <span class="math inline">\(A \in \mathcal{A}\)</span>, <span class="math inline">\(K_{\mathcal{A}_0}(\omega, A)\)</span> satisfies:</p>
<ul>
<li><p><strong>Measurability</strong>: <span class="math inline">\(K_{\mathcal{A}_0}(\cdot, A)\)</span> is <span class="math inline">\(\mathcal{A}_0\)</span>-measurable.</p></li>
<li><p><strong>Integration</strong>: For any <span class="math inline">\(B \in \mathcal{A}_0\)</span>,</p>
<p><span class="math display">\[
\int_B K_{\mathcal{A}_0}(\omega, A) \, dP(\omega) = P(A \cap B).
\]</span> This holds for <span class="math inline">\(A \in \mathcal{C}\)</span> by construction and extends to all <span class="math inline">\(A \in \mathcal{A}\)</span> via the <span class="math inline">\(\pi\)</span>-<span class="math inline">\(\lambda\)</span> theorem.</p></li>
</ul>
<p>Thus, <span class="math inline">\(K_{\mathcal{A}_0}\)</span> is a regular conditional probability kernel.</p>
<p>cf.<span class="citation" data-cites="bogachev2007measure"><a href="#ref-bogachev2007measure" role="doc-biblioref">[5]</a></span> and <span class="citation" data-cites="kallenberg2002foundations"><a href="#ref-kallenberg2002foundations" role="doc-biblioref">[4]</a></span></p>
</section>
</div>
</div>
</div>
</div>
<p>Thus, a regular conditional probability exists for any sub-<span class="math inline">\(\sigma\)</span>-algebra <span class="math inline">\(\mathcal{A}_0\)</span> in a standard Borel space.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-7-contents" aria-controls="callout-7" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Remark
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-7" class="callout-7-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<div class="proof remark">
<p><span class="proof-title"><em>Remark</em>. </span>The standard Borel space assumption is essential. For general measurable spaces, regular conditional probabilities may not exist.</p>
</div>
</div>
</div>
</div>
</section>
<section id="the-uniqueness-of-regular-conditional-probability" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="the-uniqueness-of-regular-conditional-probability"><span class="header-section-number">4</span> The Uniqueness of Regular Conditional Probability</h2>
<p>Regular conditional probabilities are unique up to <span class="math inline">\(P\)</span>-null sets. That is, if <span class="math inline">\(K_{\mathcal{A}_0}\)</span> and <span class="math inline">\(\tilde{K}_{\mathcal{A}_0}\)</span> are both regular conditional probabilities with respect to <span class="math inline">\(\mathcal{A}_0\)</span>, then there exists a <span class="math inline">\(P\)</span>-null set <span class="math inline">\(N\)</span> such that for all <span class="math inline">\(\omega \notin N\)</span> and all <span class="math inline">\(A \in \mathcal{A}\)</span>, <span class="math display">\[
K_{\mathcal{A}_0}(\omega, A) = \tilde{K}_{\mathcal{A}_0}(\omega, A).
\]</span></p>
<p>This means the regular conditional probability is essentially unique: any two versions agree outside a set of probability zero.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-8-contents" aria-controls="callout-8" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Proof (Proof of Uniqueness of Regular Conditional Probability)
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-8" class="callout-8-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="proof">
<p><span class="proof-title"><em>Proof</em> (Proof of Uniqueness of Regular Conditional Probability). </span>Let <span class="math inline">\(K_{\mathcal{A}_0}\)</span> and <span class="math inline">\(\tilde{K}_{\mathcal{A}_0}\)</span> be two regular conditional probabilities with respect to <span class="math inline">\(\mathcal{A}_0\)</span>. For each <span class="math inline">\(A \in \mathcal{A}\)</span>, define <span class="math display">\[
N_A = \{\omega \in \Omega : K_{\mathcal{A}_0}(\omega, A) \neq \tilde{K}_{\mathcal{A}_0}(\omega, A)\}.
\]</span></p>
<section id="step-1-null-sets-for-countable-generator" class="level4">
<h4 class="anchored" data-anchor-id="step-1-null-sets-for-countable-generator">Step 1: Null Sets for Countable Generator</h4>
<p>By the definition of regular conditional probability, <span class="math inline">\(K_{\mathcal{A}_0}(\cdot, A)\)</span> and <span class="math inline">\(\tilde{K}_{\mathcal{A}_0}(\cdot, A)\)</span> are both versions of <span class="math inline">\(\mathbb{E}[1_A \mid \mathcal{A}_0]\)</span>, hence they are equal <span class="math inline">\(P\)</span>-almost surely. Thus, <span class="math inline">\(P(N_A) = 0\)</span> for each <span class="math inline">\(A \in \mathcal{A}\)</span>.</p>
<p>Since <span class="math inline">\(\mathcal{A}\)</span> is standard Borel, let <span class="math inline">\(\mathcal{C}\)</span> be a countable <span class="math inline">\(\pi\)</span>-system generating <span class="math inline">\(\mathcal{A}\)</span>. Define the union of null sets: <span class="math display">\[
N = \bigcup_{A \in \mathcal{C}} N_A.
\]</span></p>
<p>As <span class="math inline">\(\mathcal{C}\)</span> is countable, <span class="math inline">\(N\)</span> is a countable union of <span class="math inline">\(P\)</span>-null sets, so <span class="math inline">\(P(N) = 0\)</span>.</p>
</section>
<section id="step-2-extension-to-the-entire-sigma-algebra-via-pi-lambda-theorem" class="level4">
<h4 class="anchored" data-anchor-id="step-2-extension-to-the-entire-sigma-algebra-via-pi-lambda-theorem">Step 2: Extension to the Entire <span class="math inline">\(\sigma\)</span>-Algebra via <span class="math inline">\(\pi\)</span>-<span class="math inline">\(\lambda\)</span> Theorem</h4>
<p>Fix <span class="math inline">\(\omega \notin N\)</span>. For this <span class="math inline">\(\omega\)</span>, define the collection of sets: <span class="math display">\[
\mathcal{D}_\omega = \{ A \in \mathcal{A} : K_{\mathcal{A}_0}(\omega, A) = \tilde{K}_{\mathcal{A}_0}(\omega, A) \}.
\]</span> We show that <span class="math inline">\(\mathcal{D}_\omega\)</span> is a <span class="math inline">\(\lambda\)</span>-system containing <span class="math inline">\(\mathcal{C}\)</span>:</p>
<ul>
<li><p><strong>Contains <span class="math inline">\(\Omega\)</span></strong>: <span class="math inline">\(K_{\mathcal{A}_0}(\omega, \Omega) = 1 = \tilde{K}_{\mathcal{A}_0}(\omega, \Omega)\)</span>, so <span class="math inline">\(\Omega \in \mathcal{D}_\omega\)</span>.</p></li>
<li><p><strong>Closed under disjoint unions</strong>: If <span class="math inline">\(A_n \in \mathcal{D}_\omega\)</span> are pairwise disjoint, then:</p>
<p><span class="math display">\[
K_{\mathcal{A}_0}\left(\omega, \bigcup_{n=1}^\infty A_n\right) = \sum_{n=1}^\infty K_{\mathcal{A}_0}(\omega, A_n) = \sum_{n=1}^\infty \tilde{K}_{\mathcal{A}_0}(\omega, A_n) = \tilde{K}_{\mathcal{A}_0}\left(\omega, \bigcup_{n=1}^\infty A_n\right).
\]</span></p></li>
<li><p><strong>Closed under complements</strong>: If <span class="math inline">\(A \in \mathcal{D}_\omega\)</span>, then:</p>
<p><span class="math display">\[
K_{\mathcal{A}_0}(\omega, A^c) = 1 - K_{\mathcal{A}_0}(\omega, A) = 1 - \tilde{K}_{\mathcal{A}_0}(\omega, A) = \tilde{K}_{\mathcal{A}_0}(\omega, A^c).
\]</span></p></li>
</ul>
<p>Since <span class="math inline">\(\mathcal{C} \subseteq \mathcal{D}_\omega\)</span> (by <span class="math inline">\(\omega \notin N\)</span>) and <span class="math inline">\(\mathcal{C}\)</span> is a <span class="math inline">\(\pi\)</span>-system, the <span class="math inline">\(\pi\)</span>-<span class="math inline">\(\lambda\)</span> theorem implies <span class="math inline">\(\sigma(\mathcal{C}) = \mathcal{A} \subseteq \mathcal{D}_\omega\)</span>. Thus, for all <span class="math inline">\(\omega \notin N\)</span>, <span class="math inline">\(K_{\mathcal{A}_0}(\omega, A) = \tilde{K}_{\mathcal{A}_0}(\omega, A)\)</span> for every <span class="math inline">\(A \in \mathcal{A}\)</span>.</p>
<p>The set <span class="math inline">\(N\)</span> is <span class="math inline">\(P\)</span>-null, and for all <span class="math inline">\(\omega \notin N\)</span>, the kernels <span class="math inline">\(K_{\mathcal{A}_0}(\omega, \cdot)\)</span> and <span class="math inline">\(\tilde{K}_{\mathcal{A}_0}(\omega, \cdot)\)</span> agree on <span class="math inline">\(\mathcal{A}\)</span>. Hence, regular conditional probabilities are unique up to <span class="math inline">\(P\)</span>-null sets.</p>
</section>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-9-contents" aria-controls="callout-9" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Remark
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-9" class="callout-9-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<div class="proof remark">
<p><span class="proof-title"><em>Remark</em>. </span>This uniqueness property ensures that, although the regular conditional probability may not be defined uniquely everywhere, any two versions coincide almost surely.</p>
</div>
</div>
</div>
</div>
</section>
<section id="representation-of-conditional-expectation-as-an-integral" class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="representation-of-conditional-expectation-as-an-integral"><span class="header-section-number">5</span> Representation of Conditional Expectation as an Integral</h2>
<p>By now, we have established that conditional probability admits a refined version (the regular conditional probability), which qualifies as a probability measure. This allows us to define an integral with respect to it.</p>
<p>In the following, we aim to demonstrate that this integral operation on the regular conditional probability precisely coincides with the conditional expectation .</p>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<div id="thm-cond-exp-as-integral" class="theorem">
<p><span class="theorem-title"><strong>Theorem 3 (Representation of Conditional Expectation as an Integral)</strong></span> Let <span class="math inline">\((\Omega, \mathcal{A}, P)\)</span> be a probability space, <span class="math inline">\(\mathcal{A}_0 \subseteq \mathcal{A}\)</span> a sub-<span class="math inline">\(\sigma\)</span>-algebra, and <span class="math inline">\(K(\omega, A)\)</span> a regular conditional probability kernel such that <span class="math inline">\(K(\omega, A) = \mathbb{E}[1_A \mid \mathcal{A}_0](\omega)\)</span> a.e. for all <span class="math inline">\(A \in \mathcal{A}\)</span>. Then for any integrable random variable <span class="math inline">\(X\)</span>, the conditional expectation satisfies: <span class="math display">\[
\mathbb{E}[X \mid \mathcal{A}_0](\omega) = \int_\Omega X(\omega') K(\omega, d\omega') \quad \text{a.e. } P.
\]</span></p>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-10-contents" aria-controls="callout-10" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Proof (Proof of <a href="#thm-cond-exp-as-integral" class="quarto-xref">Theorem&nbsp;3</a>)
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-10" class="callout-10-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="proof">
<p><span class="proof-title"><em>Proof</em> (Proof of <a href="#thm-cond-exp-as-integral" class="quarto-xref">Theorem&nbsp;3</a>). </span></p>
<section id="step-1-indicator-functions" class="level4">
<h4 class="anchored" data-anchor-id="step-1-indicator-functions">Step 1: Indicator Functions</h4>
<p>Let <span class="math inline">\(X = 1_A\)</span> for <span class="math inline">\(A \in \mathcal{A}\)</span>. By definition of the regular conditional probability: <span class="math display">\[
\mathbb{E}[1_A \mid \mathcal{A}_0](\omega) = K(\omega, A) = \int_\Omega 1_A(\omega') K(\omega, d\omega') \quad \text{a.e. } P.
\]</span></p>
</section>
<section id="step-2-simple-functions" class="level4">
<h4 class="anchored" data-anchor-id="step-2-simple-functions">Step 2: Simple Functions</h4>
<p>Let <span class="math inline">\(X = \sum_{i=1}^n a_i 1_{A_i}\)</span> with <span class="math inline">\(A_i \in \mathcal{A}\)</span> and <span class="math inline">\(a_i \in \mathbb{R}\)</span>. By linearity of conditional expectation and integration: <span class="math display">\[
\mathbb{E}[X \mid \mathcal{A}_0](\omega) = \sum_{i=1}^n a_i \mathbb{E}[1_{A_i} \mid \mathcal{A}_0](\omega) = \sum_{i=1}^n a_i \int_\Omega 1_{A_i}(\omega') K(\omega, d\omega') = \int_\Omega X(\omega') K(\omega, d\omega').
\]</span></p>
</section>
<section id="step-3-non-negative-measurable-functions" class="level4">
<h4 class="anchored" data-anchor-id="step-3-non-negative-measurable-functions">Step 3: Non-Negative Measurable Functions</h4>
<p>Let <span class="math inline">\(X \geq 0\)</span> be measurable. Take an increasing sequence of simple functions <span class="math inline">\(X_n \uparrow X\)</span>. By the monotone convergence theorem (MCT):</p>
<ul>
<li><p><span class="math inline">\(\mathbb{E}[X_n \mid \mathcal{A}_0] \uparrow \mathbb{E}[X \mid \mathcal{A}_0]\)</span> a.e.</p></li>
<li><p><span class="math inline">\(\int X_n K(\omega, d\omega') \uparrow \int X K(\omega, d\omega')\)</span>.</p></li>
</ul>
<p>Thus: <span class="math display">\[
\mathbb{E}[X \mid \mathcal{A}_0](\omega) = \lim_{n \to \infty} \mathbb{E}[X_n \mid \mathcal{A}_0](\omega) = \lim_{n \to \infty} \int X_n K(\omega, d\omega') = \int X K(\omega, d\omega') \quad \text{a.e. } P.
\]</span></p>
</section>
<section id="step-4-general-integrable-functions" class="level4">
<h4 class="anchored" data-anchor-id="step-4-general-integrable-functions">Step 4: General Integrable Functions</h4>
<p>For arbitrary integrable <span class="math inline">\(X\)</span>, decompose <span class="math inline">\(X = X^+ - X^-\)</span> with <span class="math inline">\(X^\pm \geq 0\)</span>. By Step 3: <span class="math display">\[
\mathbb{E}[X \mid \mathcal{A}_0] = \mathbb{E}[X^+ \mid \mathcal{A}_0] - \mathbb{E}[X^- \mid \mathcal{A}_0] = \int X^+ K(\omega, d\omega') - \int X^- K(\omega, d\omega') = \int X K(\omega, d\omega') \quad \text{a.e. } P.
\]</span></p>
</section>
<section id="step-5-measurability-and-uniqueness" class="level4">
<h4 class="anchored" data-anchor-id="step-5-measurability-and-uniqueness">Step 5: Measurability and Uniqueness</h4>
<ul>
<li><p><strong>Measurability</strong>: The integral <span class="math inline">\(\int X K(\omega, d\omega')\)</span> is <span class="math inline">\(\mathcal{A}_0\)</span>-measurable by construction of the kernel <span class="math inline">\(K\)</span>.</p></li>
<li><p><strong>Uniqueness</strong>: Regular conditional probability kernels agree a.e. <span class="math inline">\(P\)</span>, ensuring the integral representation is unique a.e.</p></li>
</ul>
</section>
</div>
</div>
</div>
</div>
</section>
<section id="conclusion" class="level2" data-number="6">
<h2 data-number="6" class="anchored" data-anchor-id="conclusion"><span class="header-section-number">6</span> Conclusion</h2>
<p>Through this assignment, we have systematically clarified the construction logic of Regular Conditional Probability and rigorously proved its existence and uniqueness in standard Borel spaces. This result demonstrates that, in measure spaces with well-behaved topological structures, conditional probability can be elevated to a probability kernel <span class="math inline">\(K_{\mathcal{A}_0}(\omega,A)\)</span> dependent on sample points ω , thereby resolving the “null set selection problem” inherent in classical definitions of conditional probability (where properties depend on specific events A ). This conclusion provides a rigorous mathematical foundation for the integral representation of conditional expectation.</p>
<p>However, the construction of regular conditional probability heavily relies on the structural properties of the underlying space. If extended to general measurable spaces, the existence of such kernels may fail.</p>
</section>
<section id="acknowledgement" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="acknowledgement">Acknowledgement</h2>
<p>I sincerely thank Professor Zhu, Rongchan for her guidance during this semester’s course Selected Topics in Probability. I am deeply grateful to Liu, Chenhao and Song, Ke for their invaluable support during extracurricular discussions. Special thanks also go to Zhong, Xingyu (from the Class of 2022, Strong Foundation Program), for discussing with me about whether “the definitions of conditional probability and conditional expectation are consistent across different textbook versions,” which motivated my deeper reflection on the necessity of regularizing conditional probability.</p>
<p>Additionally, I thank Zhong, Xingyu for developing the open-source typesetting tool <a href="https://github.com/sun123zxy/sunquartex">SunQuarTex</a> , which enabled efficient and polished formatting of this document.</p>



</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body" data-entry-spacing="0" role="list">
<div id="ref-Rockner2016ProbabilityNotes" class="csl-entry" role="listitem">
<div class="csl-left-margin">[1] </div><div class="csl-right-inline">M. Röckner, <span>“<span class="nocase">Probability Theory I and II</span>,”</span> 2016.</div>
</div>
<div id="ref-李贤平1997概率论基础" class="csl-entry" role="listitem">
<div class="csl-left-margin">[2] </div><div class="csl-right-inline">李贤平, <em>概率论基础</em>. 高等教育出版社, 1997.</div>
</div>
<div id="ref-韦来生2015数理统计" class="csl-entry" role="listitem">
<div class="csl-left-margin">[3] </div><div class="csl-right-inline">韦来生, <em>数理统计</em>. 科学出版社, 2015.</div>
</div>
<div id="ref-kallenberg2002foundations" class="csl-entry" role="listitem">
<div class="csl-left-margin">[4] </div><div class="csl-right-inline">O. Kallenberg and O. Kallenberg, <em>Foundations of modern probability</em>, vol. 2. Springer, 2002.</div>
</div>
<div id="ref-bogachev2007measure" class="csl-entry" role="listitem">
<div class="csl-left-margin">[5] </div><div class="csl-right-inline">V. I. Bogachev and M. A. S. Ruas, <em>Measure theory</em>, vol. 1. Springer, 2007.</div>
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/Liyvew\.github\.io\/Mathematics-Notes-Repository\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
            // target, if specified
            link.setAttribute("target", "_blank");
            if (link.getAttribute("rel") === null) {
              link.setAttribute("rel", "noopener");
            }
            // default icon
            link.classList.add("external");
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>